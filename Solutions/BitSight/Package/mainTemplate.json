{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Ariela Silberstein - ariela.silberstein@bitsighttech.com",
    "comments": "Solution template for BitSight"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "BitSight",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "bitsight_technologies_inc.bitsight_sentinel",
    "_solutionId": "[variables('solutionId')]",
    "email": "ariela.silberstein@bitsighttech.com",
    "_email": "[variables('email')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "BitSightWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "analyticRuleVersion1": "1.0.0",
    "analyticRulecontentId1": "d8844f11-3a36-4b97-9062-1e6d57c00e37",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
    "analyticRuleVersion2": "1.0.0",
    "analyticRulecontentId2": "a1275c5e-0ff4-4d15-a7b7-96018cd979f5",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
    "analyticRuleVersion3": "1.0.0",
    "analyticRulecontentId3": "d68b758a-b117-4cb8-8e1d-dcab5a4a2f21",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3')))]",
    "analyticRuleVersion4": "1.0.0",
    "analyticRulecontentId4": "161ed3ac-b242-4b13-8c6b-58716e5e9972",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4')))]",
    "analyticRuleVersion5": "1.0.0",
    "analyticRulecontentId5": "b11fdc35-6368-4cc0-8128-52cd2e2cdda0",
    "_analyticRulecontentId5": "[variables('analyticRulecontentId5')]",
    "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId5'))]",
    "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId5')))]",
    "analyticRuleVersion6": "1.0.0",
    "analyticRulecontentId6": "a5526ba9-5997-47c6-bf2e-60a08b681e9b",
    "_analyticRulecontentId6": "[variables('analyticRulecontentId6')]",
    "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId6'))]",
    "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId6')))]",
    "parserVersion1": "1.0.0",
    "parserContentId1": "BitSightAlerts-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "parserName1": "BitSightAlerts",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1')))]",
    "parserVersion2": "1.0.0",
    "parserContentId2": "BitSightBreaches-Parser",
    "_parserContentId2": "[variables('parserContentId2')]",
    "parserName2": "BitSightBreaches",
    "_parserName2": "[concat(parameters('workspace'),'/',variables('parserName2'))]",
    "parserId2": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
    "_parserId2": "[variables('parserId2')]",
    "parserTemplateSpecName2": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId2')))]",
    "parserVersion3": "1.0.0",
    "parserContentId3": "BitSightCompanyDetails-Parser",
    "_parserContentId3": "[variables('parserContentId3')]",
    "parserName3": "BitSightCompanyDetails",
    "_parserName3": "[concat(parameters('workspace'),'/',variables('parserName3'))]",
    "parserId3": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
    "_parserId3": "[variables('parserId3')]",
    "parserTemplateSpecName3": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId3')))]",
    "parserVersion4": "1.0.0",
    "parserContentId4": "BitSightCompanyRatings-Parser",
    "_parserContentId4": "[variables('parserContentId4')]",
    "parserName4": "BitSightCompanyRatings",
    "_parserName4": "[concat(parameters('workspace'),'/',variables('parserName4'))]",
    "parserId4": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
    "_parserId4": "[variables('parserId4')]",
    "parserTemplateSpecName4": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId4')))]",
    "parserVersion5": "1.0.0",
    "parserContentId5": "BitSightDiligenceHistoricalStatistics-Parser",
    "_parserContentId5": "[variables('parserContentId5')]",
    "parserName5": "BitSightDiligenceHistoricalStatistics",
    "_parserName5": "[concat(parameters('workspace'),'/',variables('parserName5'))]",
    "parserId5": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName5'))]",
    "_parserId5": "[variables('parserId5')]",
    "parserTemplateSpecName5": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId5')))]",
    "parserVersion6": "1.0.0",
    "parserContentId6": "BitSightDiligenceStatistics-Parser",
    "_parserContentId6": "[variables('parserContentId6')]",
    "parserName6": "BitSightDiligenceStatistics",
    "_parserName6": "[concat(parameters('workspace'),'/',variables('parserName6'))]",
    "parserId6": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName6'))]",
    "_parserId6": "[variables('parserId6')]",
    "parserTemplateSpecName6": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId6')))]",
    "parserVersion7": "1.0.0",
    "parserContentId7": "BitSightFindingsData-Parser",
    "_parserContentId7": "[variables('parserContentId7')]",
    "parserName7": "BitSightFindingsData",
    "_parserName7": "[concat(parameters('workspace'),'/',variables('parserName7'))]",
    "parserId7": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName7'))]",
    "_parserId7": "[variables('parserId7')]",
    "parserTemplateSpecName7": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId7')))]",
    "parserVersion8": "1.0.0",
    "parserContentId8": "BitSightFindingsSummary-Parser",
    "_parserContentId8": "[variables('parserContentId8')]",
    "parserName8": "BitSightFindingsSummary",
    "_parserName8": "[concat(parameters('workspace'),'/',variables('parserName8'))]",
    "parserId8": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName8'))]",
    "_parserId8": "[variables('parserId8')]",
    "parserTemplateSpecName8": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId8')))]",
    "parserVersion9": "1.0.0",
    "parserContentId9": "BitSightGraphData-Parser",
    "_parserContentId9": "[variables('parserContentId9')]",
    "parserName9": "BitSightGraphData",
    "_parserName9": "[concat(parameters('workspace'),'/',variables('parserName9'))]",
    "parserId9": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName9'))]",
    "_parserId9": "[variables('parserId9')]",
    "parserTemplateSpecName9": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId9')))]",
    "parserVersion10": "1.0.0",
    "parserContentId10": "BitSightIndustrialStatistics-Parser",
    "_parserContentId10": "[variables('parserContentId10')]",
    "parserName10": "BitSightIndustrialStatistics",
    "_parserName10": "[concat(parameters('workspace'),'/',variables('parserName10'))]",
    "parserId10": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName10'))]",
    "_parserId10": "[variables('parserId10')]",
    "parserTemplateSpecName10": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId10')))]",
    "parserVersion11": "1.0.0",
    "parserContentId11": "BitSightObservationStatistics-Parser",
    "_parserContentId11": "[variables('parserContentId11')]",
    "parserName11": "BitSightObservationStatistics",
    "_parserName11": "[concat(parameters('workspace'),'/',variables('parserName11'))]",
    "parserId11": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName11'))]",
    "_parserId11": "[variables('parserId11')]",
    "parserTemplateSpecName11": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId11')))]",
    "uiConfigId1": "BitSight",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "BitSight",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "1.0.0"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "BitSight Workbook with template",
        "displayName": "BitSight workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "BitSightWorkbookWorkbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insights into BitSight data."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# My Company\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"df9ebd46-967c-445f-9328-d3538237ba3b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"company\",\"label\":\"Company Name\",\"type\":2,\"isRequired\":true,\"query\":\"BitSightCompanyDetails\\r\\n| distinct Name\",\"typeSettings\":{\"showDefault\":false},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"Kati Communications, Inc.\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"0\",\"name\":\"parameters - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"ae71f2b2-2245-4937-827e-20960f9ae3b8\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Timer\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":604800000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"0\",\"name\":\"parameters - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let latest_Rating = toscalar(BitSightGraphData\\r\\n| where todatetime(RatingDate) {Timer} and CompanyName == '{company}'\\r\\n| distinct CompanyName, RatingDate, Rating\\r\\n| summarize High = max(Rating), Low = min(Rating), any(RatingDate, Rating)\\r\\n| order by any_RatingDate desc\\r\\n| project strcat_delim(\\\"-\\\",any_Rating, High, Low)\\r\\n| limit 1);\\r\\nBitSightCompanyDetails\\r\\n| where Name == '{company}'\\r\\n| sort by TimeGenerated\\r\\n| extend LatestRating = toint(todecimal(split(latest_Rating, \\\"-\\\")[0])), High = toint(todecimal(split(latest_Rating, \\\"-\\\")[1])), Low = toint(todecimal(split(latest_Rating, \\\"-\\\")[2]))\\r\\n| project-rename Name = Name, Subscription = SubscriptionType , Industry = Industry, [\\\"Customer Monitoring Count\\\"] = CustomerMonitoringCount, [\\\"Latest Rating\\\"] = LatestRating\\r\\n| project Name, [\\\"Latest Rating\\\"], High, Low, Industry, [\\\"Customer Monitoring Count\\\"]\\r\\n| limit 1\",\"size\":4,\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 3\",\"styleSettings\":{\"margin\":\"0px\",\"padding\":\"0px\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightGraphData\\r\\n| where todatetime(RatingDate) {Timer} and CompanyName == '{company}'\\r\\n| distinct CompanyName, RatingDate, Rating\\r\\n| project CompanyName, RatingDate, Rating\\r\\n| order by RatingDate asc\",\"size\":0,\"aggregation\":4,\"title\":\"Security Ratings Over Time\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"xAxis\":\"RatingDate\",\"group\":\"\",\"createOtherGroup\":0,\"showDataPoints\":true,\"ySettings\":{\"min\":300,\"max\":850}}},\"name\":\"query - 4\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightFindingsData\\r\\n| where todatetime(LastSeen) {Timer} and CompanyName == '{company}'\\r\\n| summarize count() by RiskVectorLabel\\r\\n| order by count_ desc\",\"size\":0,\"title\":\"Count of Observations by Risk Vector\",\"exportFieldName\":\"x\",\"exportParameterName\":\"SelectedRiskVectorLabel\",\"exportDefaultValue\":\"none\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"chartSettings\":{\"xAxis\":\"RiskVectorLabel\",\"createOtherGroup\":0,\"showLegend\":true}},\"name\":\"query - 5\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightFindingsData\\r\\n| where todatetime(LastSeen) {Timer} and CompanyName == '{company}'\\r\\n| where RiskVectorLabel == '{SelectedRiskVectorLabel}'\\r\\n| project-away EventVendor, EventProduct\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"sortBy\":[{\"itemKey\":\"RemediationHistoryLastRefreshStatusDate\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"RemediationHistoryLastRefreshStatusDate\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"SelectedRiskVectorLabel\",\"comparison\":\"isNotEqualTo\",\"value\":\"none\"},\"name\":\"query - 16\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightFindingsData\\r\\n| where todatetime(LastSeen) {Timer} and CompanyName == '{company}' and RiskCategory == \\\"Compromised Systems\\\"\\r\\n| extend Date = format_datetime(todatetime(LastSeen), 'yyyy-MM')\\r\\n| summarize count() by RiskVectorLabel,Date\\r\\n| project Date, count_, RiskVectorLabel\\r\\n| order by Date asc\\r\\n\",\"size\":0,\"aggregation\":4,\"title\":\"Compromised Systems by Risk Vector Over Time\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Date\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"xAxis\":\"Date\",\"yAxis\":[\"count_\"],\"group\":\"RiskVectorLabel\",\"createOtherGroup\":\"\",\"showDataPoints\":true}},\"name\":\"query - 6\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightFindingsData\\r\\n| where todatetime(LastSeen) {Timer} and CompanyName == '{company}' and RiskCategory == \\\"User Behavior\\\"\\r\\n| extend Date = format_datetime(todatetime(LastSeen), 'yyyy-MM')\\r\\n| summarize count() by RiskVectorLabel,Date\\r\\n| project Date, count_, RiskVectorLabel\\r\\n| order by Date asc\\r\\n\",\"size\":0,\"aggregation\":4,\"title\":\"User Behavior by Risk Vector Over Time\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"xAxis\":\"Date\",\"yAxis\":[\"count_\"],\"group\":\"RiskVectorLabel\",\"createOtherGroup\":\"\"}},\"name\":\"query - 15\"},{\"type\":1,\"content\":{\"json\":\"##### Diligence by Risk Vector Over Time\"},\"name\":\"text - 13\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"4d26ba1c-db98-437a-9a0c-63126f341afb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Risk_Vector\",\"label\":\"Risk Vector\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"BitSightFindingsData\\r\\n| where todatetime(LastSeen) {Timer} and CompanyName == '{company}' and RiskCategory == \\\"Diligence\\\"\\r\\n| distinct RiskVectorLabel\\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightFindingsData\\r\\n| where todatetime(LastSeen) {Timer} and CompanyName == '{company}' and RiskCategory == \\\"Diligence\\\" and ('*' in ({Risk_Vector}) or RiskVectorLabel in ({Risk_Vector}))\\r\\n| extend Date = format_datetime(todatetime(LastSeen), 'yyyy-MM')\\r\\n| summarize count() by RiskVectorLabel,Date\\r\\n| project Date, count_, RiskVectorLabel\\r\\n| order by Date asc\\r\\n\",\"size\":0,\"aggregation\":4,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Date\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"xAxis\":\"Date\",\"yAxis\":[\"count_\"],\"group\":\"RiskVectorLabel\",\"createOtherGroup\":0,\"showDataPoints\":true}},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightDiligenceHistoricalStatistics\\r\\n| where todatetime(Date) {Timer} and CompanyName == '{company}'\\r\\n| extend yyyy_mm = format_datetime(todatetime(Date), 'yyyy-MM')\\r\\n| summarize round(avg(Count),2) by yyyy_mm, Category\\r\\n| project Category, avg_Count, yyyy_mm = strcat(yyyy_mm,\\\" (Avg)\\\")\\r\\n| order by yyyy_mm asc, Category asc\\r\\n| limit 15\",\"size\":0,\"aggregation\":4,\"title\":\"Diligence Observations by Severity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"chartSettings\":{\"xAxis\":\"yyyy_mm\",\"yAxis\":[\"avg_Count\"],\"group\":\"Category\",\"createOtherGroup\":\"\"}},\"name\":\"query - 8\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightFindingsData\\r\\n| where todatetime(LastSeen) {Timer} and CompanyName == '{company}' and RiskCategory == \\\"Compromised Systems\\\" and RiskVectorLabel == \\\"Botnet Infections\\\"\\r\\n| extend d=parse_json(Details) \\r\\n| mv-expand asset = todynamic(Assets)\\r\\n| project Infection = dynamic_to_json(d[0].infection.family), [\\\"Detection Method\\\"] = dynamic_to_json(d[0].detection_method), [\\\"Last Seen\\\"] = column_ifexists(\\\"LastSeen\\\",\\\"\\\"), Asset = dynamic_to_json(asset.asset)\\r\\n| distinct Infection, [\\\"Detection Method\\\"], Asset, [\\\"Last Seen\\\"]\\r\\n| order by [\\\"Last Seen\\\"] desc\",\"size\":0,\"title\":\"Infections\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 7\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"##### Vulnerabilities\"},\"name\":\"text - 11\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"c7ff4374-c346-4c43-9354-8936687c2704\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Severity\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"BitSightFindingsSummary\\r\\n| where todatetime(StartDate) {Timer} and Company == '{company}'\\r\\n| extend Filter = case(toreal(Severity) <= 3.9 and toreal(Severity) >= 0.0, \\\"Minor\\\", \\r\\n                       toreal(Severity) <= 6.9 and toreal(Severity) >= 4.0, \\\"Moderate\\\",\\r\\n                       toreal(Severity) <= 8.9 and toreal(Severity) >= 7.0, \\\"Material\\\",\\r\\n                       toreal(Severity) <= 10.0 and toreal(Severity) >= 9.0, \\\"Severe\\\",\\r\\n                       \\\"\\\")\\r\\n| distinct Filter\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"BitSightFindingsSummary\\r\\n| where todatetime(StartDate) {Timer} and Company == '{company}'\\r\\n| distinct Name, Severity, StartDate, EndDate, Description\\r\\n| extend [\\\"Severity Details\\\"] = case(toreal(Severity) <= 3.9 and toreal(Severity) >= 0.0, \\\"Minor\\\", \\r\\n                       toreal(Severity) <= 6.9 and toreal(Severity) >= 4.0, \\\"Moderate\\\",\\r\\n                       toreal(Severity) <= 8.9 and toreal(Severity) >= 7.0, \\\"Material\\\",\\r\\n                       toreal(Severity) <= 10.0 and toreal(Severity) >= 9.0, \\\"Severe\\\",\\r\\n                       \\\"\\\")\\r\\n| where ('*' in ({Severity}) or [\\\"Severity Details\\\"] in ({Severity}))\\r\\n| project-rename Name = Name, [\\\"Start Date\\\"] = StartDate, [\\\"End Date\\\"] = EndDate\\r\\n| project Name, [\\\"Severity Details\\\"], [\\\"Start Date\\\"], [\\\"End Date\\\"], Description\\r\\n\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 9\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"My Company\"}]},\"name\":\"Main\",\"styleSettings\":{\"showBorder\":true}}],\"fromTemplateId\":\"sentinel-BitSightWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=BitSightWorkbook; logoFileName=BitSight.svg; description=Gain insights into BitSight data.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=BitSight; templateRelativePath=BitSightWorkbook.json; subtitle=; provider=BitSight}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "BitSight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Alerts_data_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Breaches_data_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Company_details_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Company_rating_details_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Diligence_historical_statistics_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Diligence_statistics_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Findings_summary_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Findings_data_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Graph_data_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Industrial_statistics_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "Observation_statistics_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "BitSightDatConnector",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "BitSight Analytics Rule 1 with template",
        "displayName": "BitSight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "BitSightDropInCompanyRatings_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Rule helps to detect when there is a drop of 10% or more in BitSight company ratings.",
                "displayName": "BitSight - drop in company ratings",
                "enabled": false,
                "query": "let timeframe = 24h;\nBitSightGraphData\n| where ingestion_time() > ago(timeframe)and toint(RatingDifferance) < 0\n| extend percentage = -(toreal(RatingDifferance)/toreal(Rating))*100\n| where percentage >= 10\n| project RatingDate, Rating, CompanyName, percentage\n",
                "queryFrequency": "P1D",
                "queryPeriod": "PT24H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "BitSight",
                    "dataTypes": [
                      "BitSightGraphData"
                    ]
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "CompanyRating": "Rating",
                  "CompanyName": "CompanyName"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "BitSight : Alert for >10% drop in ratings of {{CompanyName}}.",
                  "alertDescriptionFormat": "Alert is generated for {{CompanyName}}.\\n\\nRating Date: {{RatingDate}}\\nPercentage Drop: {{percentage}}%"
                },
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "BitSight Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "BitSight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "BitSight Analytics Rule 2 with template",
        "displayName": "BitSight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "BitSightNewAlertFound_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Rule helps to detect a new alerts generated in BitSight.",
                "displayName": "BitSight - new alert found",
                "enabled": false,
                "query": "let timeframe = 24h;\nBitSightAlerts\n| where ingestion_time() > ago(timeframe)\n| extend Severity = case( Severity contains \"INCREASE\", \"Low\",\n                          Severity contains \"WARN\" or Severity contains \"DECREASE\", \"Medium\",\n                          Severity contains \"CRITICAL\", \"High\",\n                          \"Informational\")\n| extend CompanyURL = strcat(\"https://service.bitsighttech.com/app/spm\",CompanyURL)\n| project CompanyName, Severity, Trigger, CompanyURL, AlertDate, GUID\n",
                "queryFrequency": "P1D",
                "queryPeriod": "PT24H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "BitSight",
                    "dataTypes": [
                      "BitSightAlerts"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "entityType": "URL",
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "CompanyURL"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "BitSight: Alert for {{Trigger}} in {{CompanyName}} from bitsight.",
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "Alert generated on {{AlertDate}} in BitSight.\\n\\nCompany URL: {{CompanyURL}}\\nAlert GUID: {{GUID}}"
                },
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "BitSight Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "BitSight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "BitSight Analytics Rule 3 with template",
        "displayName": "BitSight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName3'),'/',variables('analyticRuleVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "BitSightCompromisedSystemsDetected_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Rule helps to detect whenever there is a compromised systems found in BitSight.",
                "displayName": "BitSight - compromised systems detected",
                "enabled": false,
                "query": "let timeframe = 24h;\nBitSightFindingsData\n| where ingestion_time() > ago(timeframe)\n| where RiskCategory == \"Compromised Systems\"\n| extend Severity = toreal(Severity)\n| extend Severity = case( Severity <= 6.9 and Severity >= 4.0, \"Low\",\n                          Severity <= 8.9 and Severity >= 7.0, \"Medium\",\n                          Severity <= 10.0 and Severity >= 9.0, \"High\",\n                          \"Informational\")\n| project FirstSeen, CompanyName, Severity, RiskCategory, RiskVector, TemporaryId\n",
                "queryFrequency": "P1D",
                "queryPeriod": "PT24H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "BitSight",
                    "dataTypes": [
                      "BitSightFindingsData"
                    ]
                  }
                ],
                "tactics": [
                  "Execution"
                ],
                "entityMappings": [
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "RiskVector"
                      },
                      {
                        "identifier": "Category",
                        "columnName": "RiskCategory"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "BitSight: Alert for {{RiskVector}} in {{CompanyName}} from BitSight",
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "Alert is generated for {{CompanyName}}.\\n\\nRisk Vector: {{RiskVector}}\\nTemporaryId: {{TemporaryId}}\\nRisk Category: Compromised Systems"
                },
                "incidentConfiguration": {
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "BitSight Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "BitSight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "BitSight Analytics Rule 4 with template",
        "displayName": "BitSight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName4'),'/',variables('analyticRuleVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "BitSightDiligenceRiskCategoryDetected_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Rule helps to detect whenever there is a diligence risk category found in BitSight.",
                "displayName": "BitSight - diligence risk category detected",
                "enabled": false,
                "query": "let timeframe = 24h;\nBitSightFindingsData\n| where ingestion_time() > ago(timeframe)\n| where RiskCategory == \"Diligence\"\n| extend Severity = toreal(Severity)\n| extend Severity = case( Severity <= 6.9 and Severity >= 4.0, \"Low\",\n                          Severity <= 8.9 and Severity >= 7.0, \"Medium\",\n                          Severity <= 10.0 and Severity >= 9.0, \"High\",\n                          \"Informational\")\n| project FirstSeen, CompanyName, Severity, RiskCategory, TemporaryId, RiskVector\n",
                "queryFrequency": "P1D",
                "queryPeriod": "PT24H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "BitSight",
                    "dataTypes": [
                      "BitSightFindingsData"
                    ]
                  }
                ],
                "tactics": [
                  "Execution"
                ],
                "entityMappings": [
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "identifier": "Name",
                        "columnName": "RiskVector"
                      },
                      {
                        "identifier": "Category",
                        "columnName": "RiskCategory"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "BitSight: Alert for {{RiskVector}} in {{CompanyName}} from BitSight",
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "Alert is generated for {{CompanyName}}.\\n\\nRisk Vector: {{RiskVector}}\\nTemporaryId: {{TemporaryId}}\\nRisk Category: Diligence"
                },
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "BitSight Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "BitSight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "BitSight Analytics Rule 5 with template",
        "displayName": "BitSight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName5'),'/',variables('analyticRuleVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "BitSightDropInHeadlineRating_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId5')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Rule helps to detect if headline ratings is drop in BitSight.",
                "displayName": "BitSight - drop in the headline rating",
                "enabled": false,
                "query": "let timeframe = 24h;\nBitSightGraphData\n| where ingestion_time() > ago(timeframe)\n| where toint(RatingDifferance) < 0\n| project RatingDate, Rating, CompanyName, RatingDifferance\n",
                "queryFrequency": "P1D",
                "queryPeriod": "PT24H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "BitSight",
                    "dataTypes": [
                      "BitSightGraphData"
                    ]
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "CompanyRating": "Rating",
                  "CompanyName": "CompanyName"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "BitSight : Alert for drop in the headline rating of {{CompanyName}}.",
                  "alertDescriptionFormat": "Alert is generated for {{CompanyName}}.\\n\\nRating Date: {{RatingDate}}\\nRating Drop: {{RatingDifferance}}"
                },
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId5'),'/'))))]",
              "properties": {
                "description": "BitSight Analytics Rule 5",
                "parentId": "[variables('analyticRuleId5')]",
                "contentId": "[variables('_analyticRulecontentId5')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "BitSight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "BitSight Analytics Rule 6 with template",
        "displayName": "BitSight Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName6'),'/',variables('analyticRuleVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "BitSightNewBreachFound_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId6')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Rule helps to detect a new breach generated in BitSight.",
                "displayName": "BitSight - new breach found",
                "enabled": false,
                "query": "let timeframe = 24h;\nBitSightBreaches\n| where ingestion_time() > ago(timeframe)\n| extend Severity = toreal(Severity)\n| extend Severity = case( Severity == 1, \"Low\",\n                          Severity == 2, \"Medium\",\n                          Severity == 3, \"High\",\n                          \"Informational\")\n| project DateCreated, Companyname, Severity, PreviwURL, GUID\n",
                "queryFrequency": "P1D",
                "queryPeriod": "PT24H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "BitSight",
                    "dataTypes": [
                      "BitSightBreaches"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "entityType": "URL",
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "PreviwURL"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "BitSight: Alert for new breach in {{Companyname}}.",
                  "alertSeverityColumnName": "Severity",
                  "alertDescriptionFormat": "Alert is generated on {{DateCreated}} at BitSight.\\n\\nGUID: {{GUID}}\\nPreview URL: {{PreviwURL}}"
                },
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId6'),'/'))))]",
              "properties": {
                "description": "BitSight Analytics Rule 6",
                "parentId": "[variables('analyticRuleId6')]",
                "contentId": "[variables('_analyticRulecontentId6')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "BitSight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightAlerts Data Parser with template",
        "displayName": "BitSightAlerts Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName1'),'/',variables('parserVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "BitSightAlerts Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightAlerts",
                "category": "Samples",
                "functionAlias": "BitSightAlerts",
                "query": "\nlet Alerts_view  = view () {\r\n    Alerts_data_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"Alert\",\r\n                GUID = column_ifexists('guid_d', ''),\r\n                AlertType = column_ifexists('alert_type_s', ''),\r\n                AlertDate = column_ifexists('alert_date_s', ''),\r\n                StartDate = column_ifexists('start_date_s', ''),\r\n                CompanyName = column_ifexists('company_name_s', ''),\r\n                CompanyGUID = column_ifexists('company_guid_g', ''),\r\n                CompanyURL = column_ifexists('company_url_s', ''),\r\n                FolderGUID = column_ifexists('folder_guid_g', ''),\r\n                FolderName = column_ifexists('folder_name_s', ''),\r\n                Severity = column_ifexists('severity_s', ''),\r\n                Trigger = column_ifexists('trigger_s', '')\r\n    | project\r\n                TimeGenerated,\r\n\t\t\t\tEventVendor,\r\n                EventProduct,\r\n                GUID,\r\n                AlertType,\r\n                AlertDate,\r\n                StartDate,\r\n                CompanyName,\r\n                CompanyGUID,\r\n                CompanyURL,\r\n                FolderGUID,\r\n                FolderName,\r\n                Severity,\r\n                Trigger,\r\n                Type\r\n};\r\nAlerts_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightAlerts"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightAlerts",
        "category": "Samples",
        "functionAlias": "BitSightAlerts",
        "query": "\nlet Alerts_view  = view () {\r\n    Alerts_data_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"Alert\",\r\n                GUID = column_ifexists('guid_d', ''),\r\n                AlertType = column_ifexists('alert_type_s', ''),\r\n                AlertDate = column_ifexists('alert_date_s', ''),\r\n                StartDate = column_ifexists('start_date_s', ''),\r\n                CompanyName = column_ifexists('company_name_s', ''),\r\n                CompanyGUID = column_ifexists('company_guid_g', ''),\r\n                CompanyURL = column_ifexists('company_url_s', ''),\r\n                FolderGUID = column_ifexists('folder_guid_g', ''),\r\n                FolderName = column_ifexists('folder_name_s', ''),\r\n                Severity = column_ifexists('severity_s', ''),\r\n                Trigger = column_ifexists('trigger_s', '')\r\n    | project\r\n                TimeGenerated,\r\n\t\t\t\tEventVendor,\r\n                EventProduct,\r\n                GUID,\r\n                AlertType,\r\n                AlertDate,\r\n                StartDate,\r\n                CompanyName,\r\n                CompanyGUID,\r\n                CompanyURL,\r\n                FolderGUID,\r\n                FolderName,\r\n                Severity,\r\n                Trigger,\r\n                Type\r\n};\r\nAlerts_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightBreaches Data Parser with template",
        "displayName": "BitSightBreaches Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName2'),'/',variables('parserVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "BitSightBreaches Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName2')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightBreaches",
                "category": "Samples",
                "functionAlias": "BitSightBreaches",
                "query": "\nlet Breaches_view  = view () {\r\n    Breaches_data_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"Breaches\",\r\n                GUID = column_ifexists('guid_d', ''),\r\n                Date = column_ifexists('date_s', ''),\r\n                Severity = column_ifexists('Severity', ''),\r\n                Text = column_ifexists('text_s', ''),\r\n                DateCreated = column_ifexists('date_created_s', ''),\r\n                PreviwURL = column_ifexists('preview_url_s', ''),\r\n                EventType = column_ifexists('event_type_s', ''),\r\n                EventTypeDescription = column_ifexists('event_type_description_s', ''),\r\n                BreachedCompanies = column_ifexists('breached_companies_s', ''),\r\n                DependentCompanies = column_ifexists('dependent_companies_s', ''),\r\n                Companyname = column_ifexists('company_name_s', ''),\r\n                CompanyGUID = column_ifexists('company_guid_g', '')\r\n    | project\r\n                TimeGenerated,\r\n\t\t\t\tEventVendor,\r\n                EventProduct,\r\n                GUID,\r\n                Date,\r\n                Severity,\r\n                Text,\r\n                DateCreated,\r\n                PreviwURL,\r\n                EventType,\r\n                EventTypeDescription,\r\n                BreachedCompanies,\r\n                DependentCompanies,\r\n                Companyname,\r\n                CompanyGUID,\r\n                Type\r\n};\r\nBreaches_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightBreaches"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId2'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName2')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
                "contentId": "[variables('_parserContentId2')]",
                "kind": "Parser",
                "version": "[variables('parserVersion2')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName2')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightBreaches",
        "category": "Samples",
        "functionAlias": "BitSightBreaches",
        "query": "\nlet Breaches_view  = view () {\r\n    Breaches_data_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"Breaches\",\r\n                GUID = column_ifexists('guid_d', ''),\r\n                Date = column_ifexists('date_s', ''),\r\n                Severity = column_ifexists('Severity', ''),\r\n                Text = column_ifexists('text_s', ''),\r\n                DateCreated = column_ifexists('date_created_s', ''),\r\n                PreviwURL = column_ifexists('preview_url_s', ''),\r\n                EventType = column_ifexists('event_type_s', ''),\r\n                EventTypeDescription = column_ifexists('event_type_description_s', ''),\r\n                BreachedCompanies = column_ifexists('breached_companies_s', ''),\r\n                DependentCompanies = column_ifexists('dependent_companies_s', ''),\r\n                Companyname = column_ifexists('company_name_s', ''),\r\n                CompanyGUID = column_ifexists('company_guid_g', '')\r\n    | project\r\n                TimeGenerated,\r\n\t\t\t\tEventVendor,\r\n                EventProduct,\r\n                GUID,\r\n                Date,\r\n                Severity,\r\n                Text,\r\n                DateCreated,\r\n                PreviwURL,\r\n                EventType,\r\n                EventTypeDescription,\r\n                BreachedCompanies,\r\n                DependentCompanies,\r\n                Companyname,\r\n                CompanyGUID,\r\n                Type\r\n};\r\nBreaches_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId2'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId2')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
        "contentId": "[variables('_parserContentId2')]",
        "kind": "Parser",
        "version": "[variables('parserVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightCompanyDetails Data Parser with template",
        "displayName": "BitSightCompanyDetails Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName3'),'/',variables('parserVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "BitSightCompanyDetails Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName3')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightCompanyDetails",
                "category": "Samples",
                "functionAlias": "BitSightCompanyDetails",
                "query": "\nlet CompanyDetails_view  = view () {\r\n    Company_details_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"CompanyDetails\",\r\n                PrimaryCompanyGUID = column_ifexists('primary_company_guid_g', ''),\r\n                PrimaryCompanyName = column_ifexists('primary_company_name_s', ''),\r\n                AvailableUpgradeTypes = column_ifexists('available_upgrade_types_s', ''),\r\n                BulkEmailSenderStatus = column_ifexists('bulk_email_sender_status_s', ''),\r\n                CompanyFeatures = column_ifexists('company_features_s', ''),\r\n                CustomerMonitoringCount = column_ifexists('customer_monitoring_count_d', ''),\r\n                Description = column_ifexists('description_s', ''),\r\n                DisplayURL = column_ifexists('display_url_s', ''),\r\n                GUID = column_ifexists('guid_g', ''),\r\n                HasCompanyTree = column_ifexists('has_company_tree_b', ''),\r\n                HasPreferredContact = column_ifexists('has_preferred_contact_b', ''),\r\n                Hompage = column_ifexists('homepage_s', ''),\r\n                InSpmPortfolio = column_ifexists('in_spm_portfolio_b', ''),\r\n                Industry = column_ifexists('industry_s', ''),\r\n                IndustrySlug = column_ifexists('industry_slug_s', ''),\r\n                Ipv4Count = column_ifexists('ipv4_count_d', ''),\r\n                IsBundle = column_ifexists('is_bundle_b', ''),\r\n                IsCsp = column_ifexists('is_csp_b', ''),\r\n                IsMycompMysubsBundle = column_ifexists('is_mycomp_mysubs_bundle_b', ''),\r\n                IsPrimary = column_ifexists('is_primary_b', ''),\r\n                IsUnsampledAllowed = column_ifexists('is_unsampled_allowed_b', ''),\r\n                Name = column_ifexists('name_s', ''),\r\n                PeopleCount = column_ifexists('people_count_d', ''),\r\n                PermissionCanAnnotate = column_ifexists('permissions_can_annotate_b', ''),\r\n                PermissionCanDownloadCompanyReport = column_ifexists('permissions_can_download_company_report_b', ''),\r\n                PermissionCanEnableVendorAccess = column_ifexists('permissions_can_enable_vendor_access_b', ''),\r\n                PermissionCanViewCompanyReports = column_ifexists('permissions_can_view_company_reports_b', ''),\r\n                PermissionCanViewForensics = column_ifexists('permissions_can_view_forensics_b', ''),\r\n                PermissionCanViewInfrastructure = column_ifexists('permissions_can_view_infrastructure_b', ''),\r\n                PermissionCanViewIpAttributions = column_ifexists('permissions_can_view_ip_attributions_b', ''),\r\n                PermissionCanViewServiceProviders = column_ifexists('permissions_can_view_service_providers_b', ''),\r\n                PermissionsHasControl = column_ifexists('permissions_has_control_b', ''),\r\n                PrimaryDomain = column_ifexists('primary_domain_s', ''),\r\n                RatingIndustryMedian = column_ifexists('rating_industry_median_s', ''),\r\n                Ratings = column_ifexists('ratings_s', ''),\r\n                RelatedCompanies = column_ifexists('related_companies_s', ''),\r\n                SearchCount = column_ifexists('search_count_d', ''),\r\n                ServiceProvider = column_ifexists('service_provider_b', ''),\r\n                Shortname = column_ifexists('shortname_s', ''),\r\n                Sparkline = column_ifexists('sparkline_s', ''),\r\n                SubIndustry = column_ifexists('sub_industry_s', ''),\r\n                SubIndustrySlug = column_ifexists('sub_industry_slug_s', ''),\r\n                SubscriptionType = column_ifexists('subscription_type_s', ''),\r\n                SubscriptionTypeKey = column_ifexists('subscription_type_key_s', ''),\r\n                ComplianceClaimCertifications = column_ifexists('compliance_claim_certifications_s', ''),\r\n                ComplianceClaimTrustPage = column_ifexists('compliance_claim_trust_page_s', ''),\r\n                type = column_ifexists('type_s', '')\r\n    | project\r\n                TimeGenerated,\r\n\t\t\t\tEventVendor,\r\n                EventProduct,\r\n                PrimaryCompanyGUID,\r\n                PrimaryCompanyName,\r\n                AvailableUpgradeTypes,\r\n                BulkEmailSenderStatus,\r\n                CompanyFeatures,\r\n                CustomerMonitoringCount,\r\n                Description,\r\n                DisplayURL,\r\n                GUID,\r\n                HasCompanyTree,\r\n                HasPreferredContact,\r\n                Hompage,\r\n                InSpmPortfolio,\r\n                Industry,\r\n                IndustrySlug,\r\n                Ipv4Count,\r\n                IsBundle,\r\n                IsCsp,\r\n                IsMycompMysubsBundle,\r\n                IsPrimary,\r\n                IsUnsampledAllowed,\r\n                Name,\r\n                PeopleCount,\r\n                PermissionCanAnnotate,\r\n                PermissionCanDownloadCompanyReport,\r\n                PermissionCanEnableVendorAccess,\r\n                PermissionCanViewCompanyReports,\r\n                PermissionCanViewForensics,\r\n                PermissionCanViewInfrastructure,\r\n                PermissionCanViewIpAttributions,\r\n                PermissionCanViewServiceProviders,\r\n                PermissionsHasControl,\r\n                PrimaryDomain,\r\n                RatingIndustryMedian,\r\n                Ratings,\r\n                RelatedCompanies,\r\n                SearchCount,\r\n                ServiceProvider,\r\n                Shortname,\r\n                Sparkline,\r\n                SubIndustry,\r\n                SubIndustrySlug,\r\n                SubscriptionType,\r\n                SubscriptionTypeKey,\r\n                ComplianceClaimCertifications,\r\n                ComplianceClaimTrustPage,\r\n                type,\r\n                Type\r\n};\r\nCompanyDetails_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightCompanyDetails"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId3'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName3')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
                "contentId": "[variables('_parserContentId3')]",
                "kind": "Parser",
                "version": "[variables('parserVersion3')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName3')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightCompanyDetails",
        "category": "Samples",
        "functionAlias": "BitSightCompanyDetails",
        "query": "\nlet CompanyDetails_view  = view () {\r\n    Company_details_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"CompanyDetails\",\r\n                PrimaryCompanyGUID = column_ifexists('primary_company_guid_g', ''),\r\n                PrimaryCompanyName = column_ifexists('primary_company_name_s', ''),\r\n                AvailableUpgradeTypes = column_ifexists('available_upgrade_types_s', ''),\r\n                BulkEmailSenderStatus = column_ifexists('bulk_email_sender_status_s', ''),\r\n                CompanyFeatures = column_ifexists('company_features_s', ''),\r\n                CustomerMonitoringCount = column_ifexists('customer_monitoring_count_d', ''),\r\n                Description = column_ifexists('description_s', ''),\r\n                DisplayURL = column_ifexists('display_url_s', ''),\r\n                GUID = column_ifexists('guid_g', ''),\r\n                HasCompanyTree = column_ifexists('has_company_tree_b', ''),\r\n                HasPreferredContact = column_ifexists('has_preferred_contact_b', ''),\r\n                Hompage = column_ifexists('homepage_s', ''),\r\n                InSpmPortfolio = column_ifexists('in_spm_portfolio_b', ''),\r\n                Industry = column_ifexists('industry_s', ''),\r\n                IndustrySlug = column_ifexists('industry_slug_s', ''),\r\n                Ipv4Count = column_ifexists('ipv4_count_d', ''),\r\n                IsBundle = column_ifexists('is_bundle_b', ''),\r\n                IsCsp = column_ifexists('is_csp_b', ''),\r\n                IsMycompMysubsBundle = column_ifexists('is_mycomp_mysubs_bundle_b', ''),\r\n                IsPrimary = column_ifexists('is_primary_b', ''),\r\n                IsUnsampledAllowed = column_ifexists('is_unsampled_allowed_b', ''),\r\n                Name = column_ifexists('name_s', ''),\r\n                PeopleCount = column_ifexists('people_count_d', ''),\r\n                PermissionCanAnnotate = column_ifexists('permissions_can_annotate_b', ''),\r\n                PermissionCanDownloadCompanyReport = column_ifexists('permissions_can_download_company_report_b', ''),\r\n                PermissionCanEnableVendorAccess = column_ifexists('permissions_can_enable_vendor_access_b', ''),\r\n                PermissionCanViewCompanyReports = column_ifexists('permissions_can_view_company_reports_b', ''),\r\n                PermissionCanViewForensics = column_ifexists('permissions_can_view_forensics_b', ''),\r\n                PermissionCanViewInfrastructure = column_ifexists('permissions_can_view_infrastructure_b', ''),\r\n                PermissionCanViewIpAttributions = column_ifexists('permissions_can_view_ip_attributions_b', ''),\r\n                PermissionCanViewServiceProviders = column_ifexists('permissions_can_view_service_providers_b', ''),\r\n                PermissionsHasControl = column_ifexists('permissions_has_control_b', ''),\r\n                PrimaryDomain = column_ifexists('primary_domain_s', ''),\r\n                RatingIndustryMedian = column_ifexists('rating_industry_median_s', ''),\r\n                Ratings = column_ifexists('ratings_s', ''),\r\n                RelatedCompanies = column_ifexists('related_companies_s', ''),\r\n                SearchCount = column_ifexists('search_count_d', ''),\r\n                ServiceProvider = column_ifexists('service_provider_b', ''),\r\n                Shortname = column_ifexists('shortname_s', ''),\r\n                Sparkline = column_ifexists('sparkline_s', ''),\r\n                SubIndustry = column_ifexists('sub_industry_s', ''),\r\n                SubIndustrySlug = column_ifexists('sub_industry_slug_s', ''),\r\n                SubscriptionType = column_ifexists('subscription_type_s', ''),\r\n                SubscriptionTypeKey = column_ifexists('subscription_type_key_s', ''),\r\n                ComplianceClaimCertifications = column_ifexists('compliance_claim_certifications_s', ''),\r\n                ComplianceClaimTrustPage = column_ifexists('compliance_claim_trust_page_s', ''),\r\n                type = column_ifexists('type_s', '')\r\n    | project\r\n                TimeGenerated,\r\n\t\t\t\tEventVendor,\r\n                EventProduct,\r\n                PrimaryCompanyGUID,\r\n                PrimaryCompanyName,\r\n                AvailableUpgradeTypes,\r\n                BulkEmailSenderStatus,\r\n                CompanyFeatures,\r\n                CustomerMonitoringCount,\r\n                Description,\r\n                DisplayURL,\r\n                GUID,\r\n                HasCompanyTree,\r\n                HasPreferredContact,\r\n                Hompage,\r\n                InSpmPortfolio,\r\n                Industry,\r\n                IndustrySlug,\r\n                Ipv4Count,\r\n                IsBundle,\r\n                IsCsp,\r\n                IsMycompMysubsBundle,\r\n                IsPrimary,\r\n                IsUnsampledAllowed,\r\n                Name,\r\n                PeopleCount,\r\n                PermissionCanAnnotate,\r\n                PermissionCanDownloadCompanyReport,\r\n                PermissionCanEnableVendorAccess,\r\n                PermissionCanViewCompanyReports,\r\n                PermissionCanViewForensics,\r\n                PermissionCanViewInfrastructure,\r\n                PermissionCanViewIpAttributions,\r\n                PermissionCanViewServiceProviders,\r\n                PermissionsHasControl,\r\n                PrimaryDomain,\r\n                RatingIndustryMedian,\r\n                Ratings,\r\n                RelatedCompanies,\r\n                SearchCount,\r\n                ServiceProvider,\r\n                Shortname,\r\n                Sparkline,\r\n                SubIndustry,\r\n                SubIndustrySlug,\r\n                SubscriptionType,\r\n                SubscriptionTypeKey,\r\n                ComplianceClaimCertifications,\r\n                ComplianceClaimTrustPage,\r\n                type,\r\n                Type\r\n};\r\nCompanyDetails_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId3'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId3')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
        "contentId": "[variables('_parserContentId3')]",
        "kind": "Parser",
        "version": "[variables('parserVersion3')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightCompanyRatings Data Parser with template",
        "displayName": "BitSightCompanyRatings Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName4'),'/',variables('parserVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "BitSightCompanyRatings Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName4')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightCompanyRatings",
                "category": "Samples",
                "functionAlias": "BitSightCompanyRatings",
                "query": "\nlet CompanyRatings_view  = view () {\r\n    Company_rating_details_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"CompanyRating\",\r\n                CompanyName = column_ifexists('Company_name_s', ''),\r\n                Beta = column_ifexists('beta_b', ''),\r\n                Category = column_ifexists('Category', ''),\r\n                CategoryOrder = column_ifexists('category_order_d', ''),\r\n                DisplayURL = column_ifexists('display_url_s', ''),\r\n                Grade = column_ifexists('grade_s', ''),\r\n                GradeColor = column_ifexists('grade_color_s', ''),\r\n                Name = column_ifexists('name_s', ''),\r\n                Order = column_ifexists('order_d', ''),\r\n                Percentile = column_ifexists('percentile_d', ''),\r\n                Rating = column_ifexists('rating_d', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                CompanyName,\r\n                Beta,\r\n                Category,\r\n                CategoryOrder,\r\n                DisplayURL,\r\n                Grade,\r\n                GradeColor,\r\n                Name,\r\n                Order,\r\n                Percentile,\r\n                Rating,\r\n                Type\r\n};\r\nCompanyRatings_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightCompanyRatings"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId4'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName4')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
                "contentId": "[variables('_parserContentId4')]",
                "kind": "Parser",
                "version": "[variables('parserVersion4')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName4')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightCompanyRatings",
        "category": "Samples",
        "functionAlias": "BitSightCompanyRatings",
        "query": "\nlet CompanyRatings_view  = view () {\r\n    Company_rating_details_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"CompanyRating\",\r\n                CompanyName = column_ifexists('Company_name_s', ''),\r\n                Beta = column_ifexists('beta_b', ''),\r\n                Category = column_ifexists('Category', ''),\r\n                CategoryOrder = column_ifexists('category_order_d', ''),\r\n                DisplayURL = column_ifexists('display_url_s', ''),\r\n                Grade = column_ifexists('grade_s', ''),\r\n                GradeColor = column_ifexists('grade_color_s', ''),\r\n                Name = column_ifexists('name_s', ''),\r\n                Order = column_ifexists('order_d', ''),\r\n                Percentile = column_ifexists('percentile_d', ''),\r\n                Rating = column_ifexists('rating_d', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                CompanyName,\r\n                Beta,\r\n                Category,\r\n                CategoryOrder,\r\n                DisplayURL,\r\n                Grade,\r\n                GradeColor,\r\n                Name,\r\n                Order,\r\n                Percentile,\r\n                Rating,\r\n                Type\r\n};\r\nCompanyRatings_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId4'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId4')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
        "contentId": "[variables('_parserContentId4')]",
        "kind": "Parser",
        "version": "[variables('parserVersion4')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightDiligenceHistoricalStatistics Data Parser with template",
        "displayName": "BitSightDiligenceHistoricalStatistics Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName5'),'/',variables('parserVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "BitSightDiligenceHistoricalStatistics Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName5')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightDiligenceHistoricalStatistics",
                "category": "Samples",
                "functionAlias": "BitSightDiligenceHistoricalStatistics",
                "query": "\nlet DiligenceHistoricalStatistics_view  = view () {\r\n    Diligence_historical_statistics_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"DiligenceHistoricalStatistics\",\r\n                Count = column_ifexists('count_d', ''),\r\n                Category = column_ifexists('Category', ''),\r\n                Date = column_ifexists('date_s', ''),\r\n                CompanyName = column_ifexists('company_name_s', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                Count,\r\n                Category,\r\n                Date,\r\n                CompanyName,\r\n                Type\r\n};\r\nDiligenceHistoricalStatistics_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightDiligenceHistoricalStatistics"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId5'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName5')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName5'))]",
                "contentId": "[variables('_parserContentId5')]",
                "kind": "Parser",
                "version": "[variables('parserVersion5')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName5')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightDiligenceHistoricalStatistics",
        "category": "Samples",
        "functionAlias": "BitSightDiligenceHistoricalStatistics",
        "query": "\nlet DiligenceHistoricalStatistics_view  = view () {\r\n    Diligence_historical_statistics_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"DiligenceHistoricalStatistics\",\r\n                Count = column_ifexists('count_d', ''),\r\n                Category = column_ifexists('Category', ''),\r\n                Date = column_ifexists('date_s', ''),\r\n                CompanyName = column_ifexists('company_name_s', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                Count,\r\n                Category,\r\n                Date,\r\n                CompanyName,\r\n                Type\r\n};\r\nDiligenceHistoricalStatistics_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId5'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId5')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName5'))]",
        "contentId": "[variables('_parserContentId5')]",
        "kind": "Parser",
        "version": "[variables('parserVersion5')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightDiligenceStatistics Data Parser with template",
        "displayName": "BitSightDiligenceStatistics Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName6'),'/',variables('parserVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "BitSightDiligenceStatistics Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName6')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightDiligenceStatistics",
                "category": "Samples",
                "functionAlias": "BitSightDiligenceStatistics",
                "query": "\nlet DiligenceStatistics_view  = view () {\r\n    Diligence_statistics_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"DiligenceStatistics\",\r\n                Unknown = column_ifexists('unknown_d', ''),\r\n                Bad = column_ifexists('bad_d', ''),\r\n                Warn = column_ifexists('warn_d', ''),\r\n                Neutral = column_ifexists('neutral_d', ''),\r\n                Fair = column_ifexists('fair_d', ''),\r\n                Good = column_ifexists('good_d', ''),\r\n                RiskVector = column_ifexists('risk_vector_s', ''),\r\n                CompanyName = column_ifexists('Company_name_s', ''),\r\n                SpearPhishing = column_ifexists('spear_phishing_d', ''),\r\n                BitFlip = column_ifexists('bit_flip_d', ''),\r\n                TypographicalErrors = column_ifexists('typographical_errors_d', ''),\r\n                TLDVariant = column_ifexists('tld_variant_d', ''),\r\n                TotalCount = column_ifexists('total_count_d', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                Unknown,\r\n                Bad,\r\n                Warn,\r\n                Neutral,\r\n                Fair,\r\n                Good,\r\n                RiskVector,\r\n                CompanyName,\r\n                SpearPhishing,\r\n                BitFlip,\r\n                TypographicalErrors,\r\n                TLDVariant,\r\n                TotalCount,\r\n                Type\r\n};\r\nDiligenceStatistics_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightDiligenceStatistics"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId6'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName6')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName6'))]",
                "contentId": "[variables('_parserContentId6')]",
                "kind": "Parser",
                "version": "[variables('parserVersion6')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName6')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightDiligenceStatistics",
        "category": "Samples",
        "functionAlias": "BitSightDiligenceStatistics",
        "query": "\nlet DiligenceStatistics_view  = view () {\r\n    Diligence_statistics_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"DiligenceStatistics\",\r\n                Unknown = column_ifexists('unknown_d', ''),\r\n                Bad = column_ifexists('bad_d', ''),\r\n                Warn = column_ifexists('warn_d', ''),\r\n                Neutral = column_ifexists('neutral_d', ''),\r\n                Fair = column_ifexists('fair_d', ''),\r\n                Good = column_ifexists('good_d', ''),\r\n                RiskVector = column_ifexists('risk_vector_s', ''),\r\n                CompanyName = column_ifexists('Company_name_s', ''),\r\n                SpearPhishing = column_ifexists('spear_phishing_d', ''),\r\n                BitFlip = column_ifexists('bit_flip_d', ''),\r\n                TypographicalErrors = column_ifexists('typographical_errors_d', ''),\r\n                TLDVariant = column_ifexists('tld_variant_d', ''),\r\n                TotalCount = column_ifexists('total_count_d', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                Unknown,\r\n                Bad,\r\n                Warn,\r\n                Neutral,\r\n                Fair,\r\n                Good,\r\n                RiskVector,\r\n                CompanyName,\r\n                SpearPhishing,\r\n                BitFlip,\r\n                TypographicalErrors,\r\n                TLDVariant,\r\n                TotalCount,\r\n                Type\r\n};\r\nDiligenceStatistics_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId6'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId6')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName6'))]",
        "contentId": "[variables('_parserContentId6')]",
        "kind": "Parser",
        "version": "[variables('parserVersion6')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightFindingsData Data Parser with template",
        "displayName": "BitSightFindingsData Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName7'),'/',variables('parserVersion7'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName7'))]"
      ],
      "properties": {
        "description": "BitSightFindingsData Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName7')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightFindingsData",
                "category": "Samples",
                "functionAlias": "BitSightFindingsData",
                "query": "\nlet FindingsData_view  = view () {\r\n    Findings_data_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"FindingsData\",\r\n                RemediationHistoryLastRequestedRefreshDate = column_ifexists('remediation_history_last_requested_refresh_date_s', ''),\r\n                RemediationHistoryLastRefreshStatusDate = column_ifexists('remediation_history_last_refresh_status_date_s', ''),\r\n                RemediationHistoryLastRefreshStatusLabel = column_ifexists('remediation_history_last_refresh_status_label_s', ''),\r\n                RemediationHistoryLastRefreshReasonCode = column_ifexists('remediation_history_last_refresh_reason_code_s', ''),\r\n                Comments = column_ifexists('comments_s', ''),\r\n                TemporaryId = column_ifexists('temporary_id_s', ''),\r\n                PcapID = column_ifexists('pcap_id_s', ''),\r\n                AffectsRating = column_ifexists('affects_rating_b', ''),\r\n                Assets = column_ifexists('assets_s', ''),\r\n                Details = column_ifexists('details_s', ''),\r\n                EvidenceKey = column_ifexists('evidence_key_s', ''),\r\n                FirstSeen = column_ifexists('first_seen_s', ''),\r\n                LastSeen = column_ifexists('last_seen_s', ''),\r\n                RelatedFindings = column_ifexists('related_findings_s', ''),\r\n                RiskCategory = column_ifexists('risk_category_s', ''),\r\n                RiskVector = column_ifexists('risk_vector_s', ''),\r\n                RiskVectorLabel = column_ifexists('risk_vector_label_s', ''),\r\n                RolledupObservationId = column_ifexists('rolledup_observation_id_s', ''),\r\n                Severity = column_ifexists('Severity', ''),\r\n                SeverityCategory = column_ifexists('severity_category_s', ''),\r\n                Tags = column_ifexists('tags_s', ''),\r\n                AssetOverrides = column_ifexists('asset_overrides_s', ''),\r\n                Duration = column_ifexists('duration_s', ''),\r\n                AttributedCompanies = column_ifexists('attributed_companies_s', ''),\r\n                CompanyName = column_ifexists('company_name_s', ''),\r\n                RemainingDecay = column_ifexists('remaining_decay_d', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                RemediationHistoryLastRequestedRefreshDate,\r\n                RemediationHistoryLastRefreshStatusDate,\r\n                RemediationHistoryLastRefreshStatusLabel,\r\n                RemediationHistoryLastRefreshReasonCode,\r\n                Comments,\r\n                TemporaryId,\r\n                PcapID,\r\n                AffectsRating,\r\n                Assets,\r\n                Details,\r\n                EvidenceKey,\r\n                FirstSeen,\r\n                LastSeen,\r\n                RelatedFindings,\r\n                RiskCategory,\r\n                RiskVector,\r\n                RiskVectorLabel,\r\n                RolledupObservationId,\r\n                Severity,\r\n                SeverityCategory,\r\n                Tags,\r\n                AssetOverrides,\r\n                Duration,\r\n                AttributedCompanies,\r\n                CompanyName,\r\n                RemainingDecay,\r\n                Type\r\n};\r\nFindingsData_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightFindingsData"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId7'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName7')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName7'))]",
                "contentId": "[variables('_parserContentId7')]",
                "kind": "Parser",
                "version": "[variables('parserVersion7')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName7')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightFindingsData",
        "category": "Samples",
        "functionAlias": "BitSightFindingsData",
        "query": "\nlet FindingsData_view  = view () {\r\n    Findings_data_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"FindingsData\",\r\n                RemediationHistoryLastRequestedRefreshDate = column_ifexists('remediation_history_last_requested_refresh_date_s', ''),\r\n                RemediationHistoryLastRefreshStatusDate = column_ifexists('remediation_history_last_refresh_status_date_s', ''),\r\n                RemediationHistoryLastRefreshStatusLabel = column_ifexists('remediation_history_last_refresh_status_label_s', ''),\r\n                RemediationHistoryLastRefreshReasonCode = column_ifexists('remediation_history_last_refresh_reason_code_s', ''),\r\n                Comments = column_ifexists('comments_s', ''),\r\n                TemporaryId = column_ifexists('temporary_id_s', ''),\r\n                PcapID = column_ifexists('pcap_id_s', ''),\r\n                AffectsRating = column_ifexists('affects_rating_b', ''),\r\n                Assets = column_ifexists('assets_s', ''),\r\n                Details = column_ifexists('details_s', ''),\r\n                EvidenceKey = column_ifexists('evidence_key_s', ''),\r\n                FirstSeen = column_ifexists('first_seen_s', ''),\r\n                LastSeen = column_ifexists('last_seen_s', ''),\r\n                RelatedFindings = column_ifexists('related_findings_s', ''),\r\n                RiskCategory = column_ifexists('risk_category_s', ''),\r\n                RiskVector = column_ifexists('risk_vector_s', ''),\r\n                RiskVectorLabel = column_ifexists('risk_vector_label_s', ''),\r\n                RolledupObservationId = column_ifexists('rolledup_observation_id_s', ''),\r\n                Severity = column_ifexists('Severity', ''),\r\n                SeverityCategory = column_ifexists('severity_category_s', ''),\r\n                Tags = column_ifexists('tags_s', ''),\r\n                AssetOverrides = column_ifexists('asset_overrides_s', ''),\r\n                Duration = column_ifexists('duration_s', ''),\r\n                AttributedCompanies = column_ifexists('attributed_companies_s', ''),\r\n                CompanyName = column_ifexists('company_name_s', ''),\r\n                RemainingDecay = column_ifexists('remaining_decay_d', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                RemediationHistoryLastRequestedRefreshDate,\r\n                RemediationHistoryLastRefreshStatusDate,\r\n                RemediationHistoryLastRefreshStatusLabel,\r\n                RemediationHistoryLastRefreshReasonCode,\r\n                Comments,\r\n                TemporaryId,\r\n                PcapID,\r\n                AffectsRating,\r\n                Assets,\r\n                Details,\r\n                EvidenceKey,\r\n                FirstSeen,\r\n                LastSeen,\r\n                RelatedFindings,\r\n                RiskCategory,\r\n                RiskVector,\r\n                RiskVectorLabel,\r\n                RolledupObservationId,\r\n                Severity,\r\n                SeverityCategory,\r\n                Tags,\r\n                AssetOverrides,\r\n                Duration,\r\n                AttributedCompanies,\r\n                CompanyName,\r\n                RemainingDecay,\r\n                Type\r\n};\r\nFindingsData_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId7'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId7')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName7'))]",
        "contentId": "[variables('_parserContentId7')]",
        "kind": "Parser",
        "version": "[variables('parserVersion7')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightFindingsSummary Data Parser with template",
        "displayName": "BitSightFindingsSummary Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName8'),'/',variables('parserVersion8'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName8'))]"
      ],
      "properties": {
        "description": "BitSightFindingsSummary Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName8')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightFindingsSummary",
                "category": "Samples",
                "functionAlias": "BitSightFindingsSummary",
                "query": "\nlet FindingsSummary_view  = view () {\r\n    Findings_summary_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"FindingsSummary\",\r\n                Company = column_ifexists('Company_s', ''),\r\n                Confidence = column_ifexists('confidence_s', ''),\r\n                EndDate = column_ifexists('end_date_s', ''),\r\n                EventCount = column_ifexists('event_count_d', ''),\r\n                FirstSeen = column_ifexists('first_seen_s', ''),\r\n                HostCount = column_ifexists('host_count_d', ''),\r\n                Id = column_ifexists('id_s', ''),\r\n                Name = column_ifexists('name_s', ''),\r\n                Severity = column_ifexists('severity_s', ''),\r\n                StartDate = column_ifexists('start_date_s', ''),\r\n                Description = column_ifexists('description_s', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                Company,\r\n                Confidence,\r\n                EndDate,\r\n                EventCount,\r\n                FirstSeen,\r\n                HostCount,\r\n                Id,\r\n                Name,\r\n                Severity,\r\n                StartDate,\r\n                Description,\r\n                Type\r\n};\r\nFindingsSummary_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightFindingsSummary"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId8'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName8')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName8'))]",
                "contentId": "[variables('_parserContentId8')]",
                "kind": "Parser",
                "version": "[variables('parserVersion8')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName8')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightFindingsSummary",
        "category": "Samples",
        "functionAlias": "BitSightFindingsSummary",
        "query": "\nlet FindingsSummary_view  = view () {\r\n    Findings_summary_CL\r\n    | extend\r\n                EventVendor =\"BitSight\",\r\n                EventProduct =\"FindingsSummary\",\r\n                Company = column_ifexists('Company_s', ''),\r\n                Confidence = column_ifexists('confidence_s', ''),\r\n                EndDate = column_ifexists('end_date_s', ''),\r\n                EventCount = column_ifexists('event_count_d', ''),\r\n                FirstSeen = column_ifexists('first_seen_s', ''),\r\n                HostCount = column_ifexists('host_count_d', ''),\r\n                Id = column_ifexists('id_s', ''),\r\n                Name = column_ifexists('name_s', ''),\r\n                Severity = column_ifexists('severity_s', ''),\r\n                StartDate = column_ifexists('start_date_s', ''),\r\n                Description = column_ifexists('description_s', '')\r\n    | project\r\n                TimeGenerated,\r\n                EventVendor,\r\n                EventProduct,\r\n                Company,\r\n                Confidence,\r\n                EndDate,\r\n                EventCount,\r\n                FirstSeen,\r\n                HostCount,\r\n                Id,\r\n                Name,\r\n                Severity,\r\n                StartDate,\r\n                Description,\r\n                Type\r\n};\r\nFindingsSummary_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId8'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId8')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName8'))]",
        "contentId": "[variables('_parserContentId8')]",
        "kind": "Parser",
        "version": "[variables('parserVersion8')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightGraphData Data Parser with template",
        "displayName": "BitSightGraphData Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName9'),'/',variables('parserVersion9'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName9'))]"
      ],
      "properties": {
        "description": "BitSightGraphData Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName9')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightGraphData",
                "category": "Samples",
                "functionAlias": "BitSightGraphData",
                "query": "\nlet GraphData_view  = view () {\r\n    Graph_data_CL\r\n    | extend\r\n            EventVendor =\"BitSight\",\r\n            EventProduct =\"GraphData\",\r\n            RatingDate = column_ifexists('Rating_Date_s', ''),\r\n            Rating = column_ifexists('Rating_d', ''),\r\n            CompanyName = column_ifexists('Company_name_s', ''),\r\n            RatingDifferance = column_ifexists('Rating_differance_d', '')\r\n    | project\r\n            TimeGenerated,\r\n            EventVendor,\r\n            EventProduct,\r\n            RatingDate,\r\n            Rating,\r\n            CompanyName,\r\n            RatingDifferance,\r\n            Type\r\n};\r\nGraphData_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightGraphData"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId9'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName9')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName9'))]",
                "contentId": "[variables('_parserContentId9')]",
                "kind": "Parser",
                "version": "[variables('parserVersion9')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName9')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightGraphData",
        "category": "Samples",
        "functionAlias": "BitSightGraphData",
        "query": "\nlet GraphData_view  = view () {\r\n    Graph_data_CL\r\n    | extend\r\n            EventVendor =\"BitSight\",\r\n            EventProduct =\"GraphData\",\r\n            RatingDate = column_ifexists('Rating_Date_s', ''),\r\n            Rating = column_ifexists('Rating_d', ''),\r\n            CompanyName = column_ifexists('Company_name_s', ''),\r\n            RatingDifferance = column_ifexists('Rating_differance_d', '')\r\n    | project\r\n            TimeGenerated,\r\n            EventVendor,\r\n            EventProduct,\r\n            RatingDate,\r\n            Rating,\r\n            CompanyName,\r\n            RatingDifferance,\r\n            Type\r\n};\r\nGraphData_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId9'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId9')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName9'))]",
        "contentId": "[variables('_parserContentId9')]",
        "kind": "Parser",
        "version": "[variables('parserVersion9')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightIndustrialStatistics Data Parser with template",
        "displayName": "BitSightIndustrialStatistics Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName10'),'/',variables('parserVersion10'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName10'))]"
      ],
      "properties": {
        "description": "BitSightIndustrialStatistics Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion10')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName10')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightIndustrialStatistics",
                "category": "Samples",
                "functionAlias": "BitSightIndustrialStatistics",
                "query": "\nlet IndustrialStatistics_view  = view () {\r\n    Industrial_statistics_CL\r\n    | extend\r\n            EventVendor =\"BitSight\",\r\n            EventProduct =\"IndustrialStatistics\",\r\n            Count = column_ifexists('count_d', ''),\r\n            CountPeriod = column_ifexists('count_period_s', ''),\r\n            AverageDurationDays = column_ifexists('average_duration_days_d', ''),\r\n            RiskVector = column_ifexists('risk_vector_s', ''),\r\n            CompanyName = column_ifexists('Company_name_s', '')\r\n    | project\r\n            TimeGenerated,\r\n            EventVendor,\r\n            EventProduct,\r\n            Count,\r\n            CountPeriod,\r\n            AverageDurationDays,\r\n            RiskVector,\r\n            CompanyName,\r\n            Type\r\n};\r\nIndustrialStatistics_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightIndustrialStatistics"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId10'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName10')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName10'))]",
                "contentId": "[variables('_parserContentId10')]",
                "kind": "Parser",
                "version": "[variables('parserVersion10')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName10')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightIndustrialStatistics",
        "category": "Samples",
        "functionAlias": "BitSightIndustrialStatistics",
        "query": "\nlet IndustrialStatistics_view  = view () {\r\n    Industrial_statistics_CL\r\n    | extend\r\n            EventVendor =\"BitSight\",\r\n            EventProduct =\"IndustrialStatistics\",\r\n            Count = column_ifexists('count_d', ''),\r\n            CountPeriod = column_ifexists('count_period_s', ''),\r\n            AverageDurationDays = column_ifexists('average_duration_days_d', ''),\r\n            RiskVector = column_ifexists('risk_vector_s', ''),\r\n            CompanyName = column_ifexists('Company_name_s', '')\r\n    | project\r\n            TimeGenerated,\r\n            EventVendor,\r\n            EventProduct,\r\n            Count,\r\n            CountPeriod,\r\n            AverageDurationDays,\r\n            RiskVector,\r\n            CompanyName,\r\n            Type\r\n};\r\nIndustrialStatistics_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId10'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId10')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName10'))]",
        "contentId": "[variables('_parserContentId10')]",
        "kind": "Parser",
        "version": "[variables('parserVersion10')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName11')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "BitSightObservationStatistics Data Parser with template",
        "displayName": "BitSightObservationStatistics Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName11'),'/',variables('parserVersion11'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName11'))]"
      ],
      "properties": {
        "description": "BitSightObservationStatistics Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion11')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName11')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "BitSightObservationStatistics",
                "category": "Samples",
                "functionAlias": "BitSightObservationStatistics",
                "query": "\nlet ObservationStatistics_view  = view () {\r\n    Observation_statistics_CL\r\n    | extend\r\n            EventVendor =\"BitSight\",\r\n            EventProduct =\"ObservationStatistics\",\r\n            Count = column_ifexists('count_d', ''),\r\n            CountPeriod = column_ifexists('count_period_s', ''),\r\n            AverageDurationDays = column_ifexists('average_duration_days_d', ''),\r\n            RiskVector = column_ifexists('risk_vector_s', ''),\r\n            CompanyName = column_ifexists('Company_name_s', '')\r\n    | project\r\n            TimeGenerated,\r\n            EventVendor,\r\n            EventProduct,\r\n            Count,\r\n            CountPeriod,\r\n            AverageDurationDays,\r\n            RiskVector,\r\n            CompanyName,\r\n            Type\r\n};\r\nObservationStatistics_view\r\n",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "BitSightObservationStatistics"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId11'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName11')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName11'))]",
                "contentId": "[variables('_parserContentId11')]",
                "kind": "Parser",
                "version": "[variables('parserVersion11')]",
                "source": {
                  "name": "BitSight",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName11')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "BitSightObservationStatistics",
        "category": "Samples",
        "functionAlias": "BitSightObservationStatistics",
        "query": "\nlet ObservationStatistics_view  = view () {\r\n    Observation_statistics_CL\r\n    | extend\r\n            EventVendor =\"BitSight\",\r\n            EventProduct =\"ObservationStatistics\",\r\n            Count = column_ifexists('count_d', ''),\r\n            CountPeriod = column_ifexists('count_period_s', ''),\r\n            AverageDurationDays = column_ifexists('average_duration_days_d', ''),\r\n            RiskVector = column_ifexists('risk_vector_s', ''),\r\n            CompanyName = column_ifexists('Company_name_s', '')\r\n    | project\r\n            TimeGenerated,\r\n            EventVendor,\r\n            EventProduct,\r\n            Count,\r\n            CountPeriod,\r\n            AverageDurationDays,\r\n            RiskVector,\r\n            CompanyName,\r\n            Type\r\n};\r\nObservationStatistics_view\r\n",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId11'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId11')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName11'))]",
        "contentId": "[variables('_parserContentId11')]",
        "kind": "Parser",
        "version": "[variables('parserVersion11')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "BitSight data connector with template",
        "displayName": "BitSight template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "BitSight data connector with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Bitsight data connector (using Azure Functions)",
                  "publisher": "BitSight Technologies, Inc.",
                  "descriptionMarkdown": "The [BitSight](https://www.BitSight.com/) Data Connector supports evidence-based cyber risk monitoring by bringing BitSight data in Microsoft Sentinel.",
                  "graphQueries": [
                    {
                      "metricName": "Total Alerts data received",
                      "legend": "Alerts_data_CL",
                      "baseQuery": "Alerts_data_CL"
                    },
                    {
                      "metricName": "Total Breaches data received",
                      "legend": "Breaches_data_CL",
                      "baseQuery": "Breaches_data_CL"
                    },
                    {
                      "metricName": "Total Company Details received",
                      "legend": "Company_details_CL",
                      "baseQuery": "Company_details_CL"
                    },
                    {
                      "metricName": "Total Company Ratings received",
                      "legend": "Company_rating_details_CL",
                      "baseQuery": "Company_rating_details_CL"
                    },
                    {
                      "metricName": "Total Diligence Historical Statistics data received",
                      "legend": "Diligence_historical_statistics_CL",
                      "baseQuery": "Diligence_historical_statistics_CL"
                    },
                    {
                      "metricName": "Total Diligence Statistics data received",
                      "legend": "Diligence_statistics_CL",
                      "baseQuery": "Diligence_statistics_CL"
                    },
                    {
                      "metricName": "Total Findings data received",
                      "legend": "Findings_data_CL",
                      "baseQuery": "Findings_data_CL"
                    },
                    {
                      "metricName": "Total Findings Summary data received",
                      "legend": "Findings_summary_CL",
                      "baseQuery": "Findings_summary_CL"
                    },
                    {
                      "metricName": "Total Graph data received",
                      "legend": "Graph_data_CL",
                      "baseQuery": "Graph_data_CL"
                    },
                    {
                      "metricName": "Total Industrial Statistics data received",
                      "legend": "Industrial_statistics_CL",
                      "baseQuery": "Industrial_statistics_CL"
                    },
                    {
                      "metricName": "Total Observation Statistics data received",
                      "legend": "Observation_statistics_CL",
                      "baseQuery": "Observation_statistics_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "BitSight Alert Events - Alerts Event for all Companies in portfolio.",
                      "query": "Alerts_data_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Breaches Events - Breaches Event for all Companies in portfolio.",
                      "query": "Breaches_data_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Company Details Events - Company Details Event for all Companies in portfolio.",
                      "query": "Company_details_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Company Ratings Events - Company Ratings Event for all Companies.",
                      "query": "Company_rating_details_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Diligence Historical Statistics Events - Diligence Historical Statistics Event for all Companies.",
                      "query": "Diligence_historical_statistics_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Diligence Statistics Events - Diligence Statistics Event for all Companies.",
                      "query": "Diligence_statistics_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Findings Events - Findings Event for all Companies.",
                      "query": "Findings_data_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Findings Summary Events - Findings Summary Event for all Companies.",
                      "query": "Findings_summary_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Graph Events - Graph Event for all Companies.",
                      "query": "Graph_data_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Industrial Statistics Events - Industrial Statistics Event for all Companies.",
                      "query": "Industrial_statistics_CL\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "BitSight Observation Statistics Events - Observation Statistics Event for all Companies.",
                      "query": "Observation_statistics_CL\n | sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "Alerts_data_CL",
                      "lastDataReceivedQuery": "Alerts_data_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Breaches_data_CL",
                      "lastDataReceivedQuery": "Breaches_data_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Company_details_CL",
                      "lastDataReceivedQuery": "Company_details_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Company_rating_details_CL",
                      "lastDataReceivedQuery": "Company_rating_details_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Diligence_historical_statistics_CL",
                      "lastDataReceivedQuery": "Diligence_historical_statistics_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Diligence_statistics_CL",
                      "lastDataReceivedQuery": "Diligence_statistics_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Findings_data_CL",
                      "lastDataReceivedQuery": "Findings_data_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Findings_summary_CL",
                      "lastDataReceivedQuery": "Findings_summary_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Graph_data_CL",
                      "lastDataReceivedQuery": "Graph_data_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Industrial_statistics_CL",
                      "lastDataReceivedQuery": "Industrial_statistics_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "Observation_statistics_CL",
                      "lastDataReceivedQuery": "Observation_statistics_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Alerts_data_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Breaches_data_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Company_details_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Company_rating_details_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Diligence_historical_statistics_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Diligence_statistics_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Findings_data_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Findings_summary_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Graph_data_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Industrial_statistics_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Observation_statistics_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "REST API Credentials/permissions",
                        "description": "BitSight API Token is required.  See the documentation to [learn more](https://help.bitsighttech.com/hc/en-us/articles/115014888388-API-Token-Management) about API Token."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to the BitSight API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": "**STEP 1 - Steps to Create/Get Bitsight API Token**\n\n Follow these instructions to get a BitSight API Token.\n 1. For SPM App: Refer to the [User Preference](https://service.bitsight.com/app/spm/account) tab of your Account page, \n\t\tGo to Settings > Account > User Preferences > API Token.\n 2. For TPRM App: Refer to the [User Preference](https://service.bitsight.com/app/tprm/account) tab of your Account page, \n\t\tGo to Settings > Account > User Preferences > API Token.\n 3. For Classic BitSight: Go to your [Account](https://service.bitsight.com/settings) page, \n\t\tGo to Settings > Account > API Token."
                    },
                    {
                      "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the BitSight data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following) readily available.., as well as the BitSight API Token.",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": "Use this method for automated deployment of the BitSight connector.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-BitSight-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the below information : \n\t\tFunction Name \n\t\tWorkspace ID \n\t\tWorkspace Key \n\t\tAPI_token \n\t\tCompanies \n\t\tAlerts_Table_Name \n\t\tBreaches_Table_Name \n\t\tCompany_Table_Name \n\t\tCompany_Rating_Details_Table_Name \n\t\tDiligence_Historical_Statistics_Table_Name \n\t\tDiligence_Statistics_Table_Name \n\t\tFindings_Summary_Table_Name \n\t\tFindings_Table_Name \n\t\tGraph_Table_Name \n\t\tIndustrial_Statistics_Table_Name \n\t\tObservation_Statistics_Table_Name \n\t\tLog Level \n\t\tBitSight Schedule \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
                      "title": "Option 1 - Azure Resource Manager (ARM) Template"
                    },
                    {
                      "description": "Use the following step-by-step instructions to deploy the BitSight data connector manually with Azure Functions (Deployment via Visual Studio Code).",
                      "title": "Option 2 - Manual Deployment of Azure Functions"
                    },
                    {
                      "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-BitSight-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. BitSightXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.8 or above.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
                    },
                    {
                      "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following application settings individually, with their respective values (case-sensitive): \n\t\tWorkspaceID \n\t\tWorkspaceKey \n\t\tAPI_token \n\t\tCompanies \n\t\tAlerts_Table_Name \n\t\tBreaches_Table_Name \n\t\tCompany_Table_Name \n\t\tCompany_Rating_Details_Table_Name \n\t\tDiligence_Historical_Statistics_Table_Name \n\t\tDiligence_Statistics_Table_Name \n\t\tFindings_Summary_Table_Name \n\t\tFindings_Table_Name \n\t\tGraph_Table_Name \n\t\tIndustrial_Statistics_Table_Name \n\t\tObservation_Statistics_Table_Name \n\t\tLogLevel \n\t\tSchedule \n4. Once all application settings have been entered, click **Save**."
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "BitSight",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Ariela Silberstein",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "BitSight Support",
                  "email": "supprt@bitsight.com",
                  "tier": "Partner",
                  "link": "https://www.bitsight.com/customer-success-support"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Bitsight data connector (using Azure Functions)",
          "publisher": "BitSight Technologies, Inc.",
          "descriptionMarkdown": "The [BitSight](https://www.BitSight.com/) Data Connector supports evidence-based cyber risk monitoring by bringing BitSight data in Microsoft Sentinel.",
          "graphQueries": [
            {
              "metricName": "Total Alerts data received",
              "legend": "Alerts_data_CL",
              "baseQuery": "Alerts_data_CL"
            },
            {
              "metricName": "Total Breaches data received",
              "legend": "Breaches_data_CL",
              "baseQuery": "Breaches_data_CL"
            },
            {
              "metricName": "Total Company Details received",
              "legend": "Company_details_CL",
              "baseQuery": "Company_details_CL"
            },
            {
              "metricName": "Total Company Ratings received",
              "legend": "Company_rating_details_CL",
              "baseQuery": "Company_rating_details_CL"
            },
            {
              "metricName": "Total Diligence Historical Statistics data received",
              "legend": "Diligence_historical_statistics_CL",
              "baseQuery": "Diligence_historical_statistics_CL"
            },
            {
              "metricName": "Total Diligence Statistics data received",
              "legend": "Diligence_statistics_CL",
              "baseQuery": "Diligence_statistics_CL"
            },
            {
              "metricName": "Total Findings data received",
              "legend": "Findings_data_CL",
              "baseQuery": "Findings_data_CL"
            },
            {
              "metricName": "Total Findings Summary data received",
              "legend": "Findings_summary_CL",
              "baseQuery": "Findings_summary_CL"
            },
            {
              "metricName": "Total Graph data received",
              "legend": "Graph_data_CL",
              "baseQuery": "Graph_data_CL"
            },
            {
              "metricName": "Total Industrial Statistics data received",
              "legend": "Industrial_statistics_CL",
              "baseQuery": "Industrial_statistics_CL"
            },
            {
              "metricName": "Total Observation Statistics data received",
              "legend": "Observation_statistics_CL",
              "baseQuery": "Observation_statistics_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "Alerts_data_CL",
              "lastDataReceivedQuery": "Alerts_data_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Breaches_data_CL",
              "lastDataReceivedQuery": "Breaches_data_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Company_details_CL",
              "lastDataReceivedQuery": "Company_details_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Company_rating_details_CL",
              "lastDataReceivedQuery": "Company_rating_details_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Diligence_historical_statistics_CL",
              "lastDataReceivedQuery": "Diligence_historical_statistics_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Diligence_statistics_CL",
              "lastDataReceivedQuery": "Diligence_statistics_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Findings_data_CL",
              "lastDataReceivedQuery": "Findings_data_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Findings_summary_CL",
              "lastDataReceivedQuery": "Findings_summary_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Graph_data_CL",
              "lastDataReceivedQuery": "Graph_data_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Industrial_statistics_CL",
              "lastDataReceivedQuery": "Industrial_statistics_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "Observation_statistics_CL",
              "lastDataReceivedQuery": "Observation_statistics_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "Alerts_data_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Breaches_data_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Company_details_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Company_rating_details_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Diligence_historical_statistics_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Diligence_statistics_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Findings_data_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Findings_summary_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Graph_data_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Industrial_statistics_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "Observation_statistics_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "BitSight Alert Events - Alerts Event for all Companies in portfolio.",
              "query": "Alerts_data_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Breaches Events - Breaches Event for all Companies in portfolio.",
              "query": "Breaches_data_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Company Details Events - Company Details Event for all Companies in portfolio.",
              "query": "Company_details_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Company Ratings Events - Company Ratings Event for all Companies.",
              "query": "Company_rating_details_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Diligence Historical Statistics Events - Diligence Historical Statistics Event for all Companies.",
              "query": "Diligence_historical_statistics_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Diligence Statistics Events - Diligence Statistics Event for all Companies.",
              "query": "Diligence_statistics_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Findings Events - Findings Event for all Companies.",
              "query": "Findings_data_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Findings Summary Events - Findings Summary Event for all Companies.",
              "query": "Findings_summary_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Graph Events - Graph Event for all Companies.",
              "query": "Graph_data_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Industrial Statistics Events - Industrial Statistics Event for all Companies.",
              "query": "Industrial_statistics_CL\n | sort by TimeGenerated desc"
            },
            {
              "description": "BitSight Observation Statistics Events - Observation Statistics Event for all Companies.",
              "query": "Observation_statistics_CL\n | sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "REST API Credentials/permissions",
                "description": "BitSight API Token is required.  See the documentation to [learn more](https://help.bitsighttech.com/hc/en-us/articles/115014888388-API-Token-Management) about API Token."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to the BitSight API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": "**STEP 1 - Steps to Create/Get Bitsight API Token**\n\n Follow these instructions to get a BitSight API Token.\n 1. For SPM App: Refer to the [User Preference](https://service.bitsight.com/app/spm/account) tab of your Account page, \n\t\tGo to Settings > Account > User Preferences > API Token.\n 2. For TPRM App: Refer to the [User Preference](https://service.bitsight.com/app/tprm/account) tab of your Account page, \n\t\tGo to Settings > Account > User Preferences > API Token.\n 3. For Classic BitSight: Go to your [Account](https://service.bitsight.com/settings) page, \n\t\tGo to Settings > Account > API Token."
            },
            {
              "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the BitSight data connector, have the Workspace ID and Workspace Primary Key (can be copied from the following) readily available.., as well as the BitSight API Token.",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": "Use this method for automated deployment of the BitSight connector.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-BitSight-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the below information : \n\t\tFunction Name \n\t\tWorkspace ID \n\t\tWorkspace Key \n\t\tAPI_token \n\t\tCompanies \n\t\tAlerts_Table_Name \n\t\tBreaches_Table_Name \n\t\tCompany_Table_Name \n\t\tCompany_Rating_Details_Table_Name \n\t\tDiligence_Historical_Statistics_Table_Name \n\t\tDiligence_Statistics_Table_Name \n\t\tFindings_Summary_Table_Name \n\t\tFindings_Table_Name \n\t\tGraph_Table_Name \n\t\tIndustrial_Statistics_Table_Name \n\t\tObservation_Statistics_Table_Name \n\t\tLog Level \n\t\tBitSight Schedule \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
              "title": "Option 1 - Azure Resource Manager (ARM) Template"
            },
            {
              "description": "Use the following step-by-step instructions to deploy the BitSight data connector manually with Azure Functions (Deployment via Visual Studio Code).",
              "title": "Option 2 - Manual Deployment of Azure Functions"
            },
            {
              "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-BitSight-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. BitSightXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.8 or above.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
            },
            {
              "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following application settings individually, with their respective values (case-sensitive): \n\t\tWorkspaceID \n\t\tWorkspaceKey \n\t\tAPI_token \n\t\tCompanies \n\t\tAlerts_Table_Name \n\t\tBreaches_Table_Name \n\t\tCompany_Table_Name \n\t\tCompany_Rating_Details_Table_Name \n\t\tDiligence_Historical_Statistics_Table_Name \n\t\tDiligence_Statistics_Table_Name \n\t\tFindings_Summary_Table_Name \n\t\tFindings_Table_Name \n\t\tGraph_Table_Name \n\t\tIndustrial_Statistics_Table_Name \n\t\tObservation_Statistics_Table_Name \n\t\tLogLevel \n\t\tSchedule \n4. Once all application settings have been entered, click **Save**."
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "BitSight",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Ariela Silberstein",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "BitSight Support",
          "email": "supprt@bitsight.com",
          "tier": "Partner",
          "link": "https://www.bitsight.com/customer-success-support"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId5')]",
              "version": "[variables('analyticRuleVersion5')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId6')]",
              "version": "[variables('analyticRuleVersion6')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId2')]",
              "version": "[variables('parserVersion2')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId3')]",
              "version": "[variables('parserVersion3')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId4')]",
              "version": "[variables('parserVersion4')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId5')]",
              "version": "[variables('parserVersion5')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId6')]",
              "version": "[variables('parserVersion6')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId7')]",
              "version": "[variables('parserVersion7')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId8')]",
              "version": "[variables('parserVersion8')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId9')]",
              "version": "[variables('parserVersion9')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId10')]",
              "version": "[variables('parserVersion10')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId11')]",
              "version": "[variables('parserVersion11')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            }
          ]
        },
        "firstPublishDate": "2023-02-20",
        "lastPublishDate": "2024-02-20",
        "providers": [
          "Bitsight"
        ],
        "categories": {
          "domains": [
            "Security - Others"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
