// Usage Instruction :
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name and alias (e.g. BitSightCompanyDetails).
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. BitSightCompanyDetails | take 10).
// References :
// Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
// Tech Community Blog on KQL Functions : https://techcommunity.microsoft.com/t5/Azure-Sentinel/Using-KQL-functions-to-speed-up-analysis-in-Azure-Sentinel/ba-p/712381
//
let CompanyDetails_view  = view () {
    Company_details_CL
    | extend
                EventVendor ="BitSight",
                EventProduct ="CompanyDetails",
                PrimaryCompanyGUID = column_ifexists('primary_company_guid_g', ''),
                PrimaryCompanyName = column_ifexists('primary_company_name_s', ''),
                AvailableUpgradeTypes = column_ifexists('available_upgrade_types_s', ''),
                BulkEmailSenderStatus = column_ifexists('bulk_email_sender_status_s', ''),
                CompanyFeatures = column_ifexists('company_features_s', ''),
                CustomerMonitoringCount = column_ifexists('customer_monitoring_count_d', ''),
                Description = column_ifexists('description_s', ''),
                DisplayURL = column_ifexists('display_url_s', ''),
                GUID = column_ifexists('guid_g', ''),
                HasCompanyTree = column_ifexists('has_company_tree_b', ''),
                HasPreferredContact = column_ifexists('has_preferred_contact_b', ''),
                Hompage = column_ifexists('homepage_s', ''),
                InSpmPortfolio = column_ifexists('in_spm_portfolio_b', ''),
                Industry = column_ifexists('industry_s', ''),
                IndustrySlug = column_ifexists('industry_slug_s', ''),
                Ipv4Count = column_ifexists('ipv4_count_d', ''),
                IsBundle = column_ifexists('is_bundle_b', ''),
                IsCsp = column_ifexists('is_csp_b', ''),
                IsMycompMysubsBundle = column_ifexists('is_mycomp_mysubs_bundle_b', ''),
                IsPrimary = column_ifexists('is_primary_b', ''),
                IsUnsampledAllowed = column_ifexists('is_unsampled_allowed_b', ''),
                Name = column_ifexists('name_s', ''),
                PeopleCount = column_ifexists('people_count_d', ''),
                PermissionCanAnnotate = column_ifexists('permissions_can_annotate_b', ''),
                PermissionCanDownloadCompanyReport = column_ifexists('permissions_can_download_company_report_b', ''),
                PermissionCanEnableVendorAccess = column_ifexists('permissions_can_enable_vendor_access_b', ''),
                PermissionCanViewCompanyReports = column_ifexists('permissions_can_view_company_reports_b', ''),
                PermissionCanViewForensics = column_ifexists('permissions_can_view_forensics_b', ''),
                PermissionCanViewInfrastructure = column_ifexists('permissions_can_view_infrastructure_b', ''),
                PermissionCanViewIpAttributions = column_ifexists('permissions_can_view_ip_attributions_b', ''),
                PermissionCanViewServiceProviders = column_ifexists('permissions_can_view_service_providers_b', ''),
                PermissionsHasControl = column_ifexists('permissions_has_control_b', ''),
                PrimaryDomain = column_ifexists('primary_domain_s', ''),
                RatingIndustryMedian = column_ifexists('rating_industry_median_s', ''),
                Ratings = column_ifexists('ratings_s', ''),
                RelatedCompanies = column_ifexists('related_companies_s', ''),
                SearchCount = column_ifexists('search_count_d', ''),
                ServiceProvider = column_ifexists('service_provider_b', ''),
                Shortname = column_ifexists('shortname_s', ''),
                Sparkline = column_ifexists('sparkline_s', ''),
                SubIndustry = column_ifexists('sub_industry_s', ''),
                SubIndustrySlug = column_ifexists('sub_industry_slug_s', ''),
                SubscriptionType = column_ifexists('subscription_type_s', ''),
                SubscriptionTypeKey = column_ifexists('subscription_type_key_s', ''),
                ComplianceClaimCertifications = column_ifexists('compliance_claim_certifications_s', ''),
                ComplianceClaimTrustPage = column_ifexists('compliance_claim_trust_page_s', ''),
                type = column_ifexists('type_s', '')
    | project
                TimeGenerated,
				EventVendor,
                EventProduct,
                PrimaryCompanyGUID,
                PrimaryCompanyName,
                AvailableUpgradeTypes,
                BulkEmailSenderStatus,
                CompanyFeatures,
                CustomerMonitoringCount,
                Description,
                DisplayURL,
                GUID,
                HasCompanyTree,
                HasPreferredContact,
                Hompage,
                InSpmPortfolio,
                Industry,
                IndustrySlug,
                Ipv4Count,
                IsBundle,
                IsCsp,
                IsMycompMysubsBundle,
                IsPrimary,
                IsUnsampledAllowed,
                Name,
                PeopleCount,
                PermissionCanAnnotate,
                PermissionCanDownloadCompanyReport,
                PermissionCanEnableVendorAccess,
                PermissionCanViewCompanyReports,
                PermissionCanViewForensics,
                PermissionCanViewInfrastructure,
                PermissionCanViewIpAttributions,
                PermissionCanViewServiceProviders,
                PermissionsHasControl,
                PrimaryDomain,
                RatingIndustryMedian,
                Ratings,
                RelatedCompanies,
                SearchCount,
                ServiceProvider,
                Shortname,
                Sparkline,
                SubIndustry,
                SubIndustrySlug,
                SubscriptionType,
                SubscriptionTypeKey,
                ComplianceClaimCertifications,
                ComplianceClaimTrustPage,
                type,
                Type
};
CompanyDetails_view
